<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
    "http://www.w3.org/TR/html4/strict.dtd"
    >
<html lang="en">
<head>
    <title>Router traffic monitor realtime</title>
    <script type="text/JavaScript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
    <script language="javascript" type="text/javascript" src="../js/jquery/jquery.flot.js"></script>
    <script language="javascript" type="text/javascript" src="../js/jquery/jquery-ui-1.10.0.custom.js"></script>
    <link rel="stylesheet" href="../js/jquery/css/ui-lightness/jquery-ui-1.10.0.custom.css" />
</head>
<body>
    <!-- Insert your content here -->
    <h2>Router Traffic Monitor Realtime (30 min)</h2>
    <div id="graph1" style="width:1000px;height:500px"></div>
    <div id="graph2" style="width:1000px;height:500px"></div>
        
    <script type="text/javascript">      

    $(function () {

      UplinkVolume = [];
      DownlinkVolume = [];
      UplinkRate = [];
      DownlinkRate = [];
      Id = 0;
      lastUpVol = 0;
      lastDownVol = 0;
      Period = 30 * 60; // 30 minutes expressed in seconds
      SampleRate = 2; // seconds
      PeriodLength = (Period / SampleRate).toFixed(0);
		
                
      function updateTrafficRT() {
	      $.ajax({
	      url: "/cgi-bin/TrafficRT.py",
	      method: 'GET',
	      data: {sessionId: Id},
	      dataType: 'json',
	      cache: false,
	      }).done(function(series) {
		 // [SessionId, Time, UplinkVolume, DownlinkVolume, UplinkRate, DownlinkRate] 
		
		Id = series[0];
		
		UpVol = new Array(2);
		UpVol[0] = series[1];
		if (lastUpVol == 0)
		   lastUpVol = series[2];
		UpVol[1] = (series[2] - lastUpVol);
		UplinkVolume.push(UpVol);
		if (UplinkVolume.length > PeriodLength)
		   UplinkVolume.shift();
		lastUpVol = series[2];
		upSum = 0;
		for (var ind = 0; ind < UplinkVolume.length; ind++) {
		  upSum += UplinkVolume[ind][1];
		}

		DownVol = new Array(2);
		DownVol[0] = series[1];
		if (lastDownVol == 0)
		   lastDownVol = series[3];
		DownVol[1] = (series[3] - lastDownVol);
		DownlinkVolume.push(DownVol);
		if (DownlinkVolume.length > PeriodLength)
		   DownlinkVolume.shift();
		lastDownVol = series[3];
		downSum = 0;
		for (var ind = 0; ind < DownlinkVolume.length; ind++) {
		  downSum += DownlinkVolume[ind][1];
		}

		UpRate = new Array(2);
		UpRate[0] = series[1];
		UpRate[1] = series[4];
		UplinkRate.push(UpRate);
		if (UplinkRate.length > PeriodLength)
		   UplinkRate.shift();

		DownRate = new Array(2);
		DownRate[0] = series[1];
		DownRate[1] = series[5];
		DownlinkRate.push(DownRate);
		if (DownlinkRate.length > PeriodLength)
		   DownlinkRate.shift();
		
                $.plot($("#graph1"), [{data: UplinkVolume,   lines: {show: true, fill: true}, label: "Uplink volume (" + (upSum /1024).toFixed(1) + " kB)"},
				      {data: DownlinkVolume, lines: {show: true, fill: true}, label: "Downlink volume (" + (downSum /1024).toFixed(1) + " kB)"},
				      {data: UplinkRate,     yaxis: 2,  		      label: "Uplink rate (" + UpRate[1] + " kbps)"},
				      {data: DownlinkRate,   yaxis: 2,                        label: "Downlink rate (" + DownRate[1] + " kbps)"}],
		                     {xaxis: {mode: "time"}, yaxes: [ {min: 0 }, { position: "right", min: 0} ]});
                }); // ajax
	      
	  setTimeout(updateTrafficRT, SampleRate * 1000); // seconds
      } // updateTrafficRT
      
      updateTrafficRT();

    });
    </script>
</body>
</html>
